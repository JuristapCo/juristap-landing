---
import { Image } from 'astro:assets';
import Logo from '../assets/images/brand/logo-horizontal-white.webp';
---

<header
  class="fixed top-2 left-1/2 -translate-x-1/2 w-[95%] max-w-7xl text-white rounded-2xl z-40 transition-all duration-500"
>
  <div
    class="container mx-auto flex items-center justify-between p-4 md:p-4 transition-all duration-500"
    id="headerContent"
  >
    <Image
      src={Logo}
      alt="Juristap"
      class="w-auto h-8 hover:opacity-90 transition-all duration-300 hover:scale-105"
      draggable="false"
    />

    <!-- 游녢 A침adimos un id para poder seleccionar solo este nav -->
    <nav
      id="desktopNav"
      class="hidden lg:flex gap-8 relative items-center desktop-nav header-navigation"
    >
      <div
        class="absolute inset-0 bg-white/90 rounded-full transition-all duration-500 ease-in-out opacity-0"
        id="hoverBubble"
      >
      </div>

      <a
        href="#"
        class="relative group px-4 py-2.5 rounded-lg z-10 flex items-center h-10 header-nav-item"
      >
        <span class="transition-all duration-300 group-hover:text-primary group-hover:scale-105"
          >Soy abogado</span
        >
      </a>
      <a
        href="#"
        class="relative group px-4 py-2.5 rounded-lg z-10 flex items-center h-10 header-nav-item"
      >
        <span class="transition-all duration-300 group-hover:text-primary group-hover:scale-105"
          >Soy un cliente</span
        >
      </a>
      <a
        href="#"
        class="relative group px-4 py-2.5 rounded-lg z-10 flex items-center h-10 header-nav-item"
      >
        <span class="transition-all duration-300 group-hover:text-primary group-hover:scale-105"
          >Cont치ctenos</span
        >
      </a>
    </nav>

    <div class="flex items-center gap-4">
      <button
        class="hidden sm:block bg-white text-primary font-medium cursor-pointer px-6 py-2 rounded-lg hover:bg-primary-400 hover:text-white transition-all duration-300 shadow-md hover:shadow-lg hover:scale-105 active:scale-95"
      >
        Registrarse
      </button>

      <!-- Mobile Menu Button -->
      <button
        id="menuToggle"
        class="lg:hidden text-white focus:outline-none hover:text-secondary-300 transition-colors relative w-8 h-8"
        aria-label="Abrir men칰 m칩vil"
      >
        <div class="absolute inset-0 flex items-center justify-center">
          <svg
            class="w-6 h-6 transition-all duration-300 transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg
            class="w-6 h-6 transition-all duration-300 transform absolute opacity-0 rotate-90"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </div>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div
  id="mobileMenu"
  class="fixed inset-0 bg-gradient-to-br from-primary via-primary-600 to-primary-700 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out overflow-hidden"
  role="dialog"
  aria-modal="true"
  aria-label="Men칰 m칩vil"
>
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-10">
    <div
      class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent"
    >
    </div>
    <div
      class="absolute inset-0 bg-[linear-gradient(45deg,_transparent_25%,_rgba(255,255,255,0.1)_50%,_transparent_75%)] bg-[length:20px_20px]"
    >
    </div>
  </div>

  <div class="relative h-full w-full">
    <!-- Close button -->
    <button
      id="mobileMenuClose"
      class="absolute top-6 right-6 text-white p-2 hover:text-secondary-300 transition-colors bg-white/10 rounded-full backdrop-blur-sm hover:bg-white/20"
      aria-label="Cerrar men칰 m칩vil"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Mobile menu content -->
    <div class="flex flex-col items-center justify-center h-full px-6 py-12">
      <div class="w-full max-w-sm space-y-8">
        <!-- Logo -->
        <div class="text-center mb-12">
          <Image src={Logo} alt="Juristap" class="w-auto h-10 mx-auto mb-4" draggable="false" />
          <p class="text-white/80 text-sm">Tu soluci칩n legal inteligente</p>
        </div>

        <!-- Navigation -->
        <nav class="flex flex-col items-center gap-6">
          <a
            href="#"
            class="mobile-menu-item w-full text-center text-xl font-medium text-white hover:text-secondary-300 transition-all duration-300 py-3 px-6 rounded-xl bg-white/10 backdrop-blur-sm hover:bg-white/20 hover:scale-105 active:scale-95"
          >
            Soy abogado
          </a>
          <a
            href="#"
            class="mobile-menu-item w-full text-center text-xl font-medium text-white hover:text-secondary-300 transition-all duration-300 py-3 px-6 rounded-xl bg-white/10 backdrop-blur-sm hover:bg-white/20 hover:scale-105 active:scale-95"
          >
            Soy un cliente
          </a>
          <a
            href="#"
            class="mobile-menu-item w-full text-center text-xl font-medium text-white hover:text-secondary-300 transition-all duration-300 py-3 px-6 rounded-xl bg-white/10 backdrop-blur-sm hover:bg-white/20 hover:scale-105 active:scale-95"
          >
            Cont치ctenos
          </a>
        </nav>

        <!-- Register Button -->
        <div class="mt-12 text-center">
          <button
            class="w-full bg-white text-primary font-medium px-8 py-4 rounded-xl hover:bg-primary-400 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 active:scale-95"
          >
            Registrarse
          </button>
          <p class="mt-4 text-white/60 text-sm">칔nete a la revoluci칩n legal</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuClose = document.getElementById('mobileMenuClose');
    const header = document.querySelector('header');
    const headerContent = document.getElementById('headerContent');
    const logo = headerContent?.querySelector('img');

    // 游녢 Seleccionamos solo el nav del header y sus enlaces
    const headerNav = document.getElementById('desktopNav'); // 游녣 CAMBIO
    const navLinks = headerNav?.querySelectorAll('a') ?? []; // 游녣 CAMBIO
    const hoverBubble = document.getElementById('hoverBubble');

    const hamburgerIcon = menuToggle?.querySelector('svg:first-child');
    const closeIcon = menuToggle?.querySelector('svg:last-child');

    /* ---------- Hover bubble ---------- */
    navLinks.forEach(link => {
      link.addEventListener('mouseenter', () => {
        if (!hoverBubble) return;

        const rect = link.getBoundingClientRect();
        const navRect = headerNav?.getBoundingClientRect(); // 游녣 CAMBIO
        if (!navRect) return;

        const isScrolled = window.scrollY > 50;
        const scale = isScrolled ? 0.9 : 1;

        hoverBubble.style.width = `${rect.width / scale}px`;
        hoverBubble.style.height = `${rect.height / scale}px`;
        hoverBubble.style.left = `${(rect.left - navRect.left) / scale}px`;
        hoverBubble.style.top = `${(rect.top - navRect.top) / scale}px`;
        hoverBubble.style.opacity = '1';
        hoverBubble.style.transform = 'scale(1.05)';
      });

      link.addEventListener('mouseleave', () => {
        if (hoverBubble) hoverBubble.style.transform = 'scale(1)';
      });
    });

    // Ocultar la burbuja cuando el mouse salga de ESTE nav
    headerNav?.addEventListener('mouseleave', () => {
      // 游녣 CAMBIO
      if (!hoverBubble) return;
      hoverBubble.style.opacity = '0';
      hoverBubble.style.transform = 'scale(1)';
    });

    /* ---------- Scroll shrink ---------- */
    window.addEventListener('scroll', () => {
      const scrolled = window.scrollY > 50;

      header?.classList.toggle('top-2', scrolled);
      header?.classList.toggle('w-[90%]', scrolled);
      header?.classList.toggle('scale-90', scrolled);
      header?.classList.toggle('bg-primary/80', scrolled);
      header?.classList.toggle('backdrop-blur-md', scrolled);
      header?.classList.toggle('shadow-xl', scrolled);
      header?.classList.toggle('md:max-w-5xl', scrolled);
      header?.classList.toggle('px-4', scrolled);
      header?.classList.toggle('md:px-6', scrolled);

      headerContent?.classList.toggle('p-3', scrolled);
      headerContent?.classList.toggle('md:p-4', scrolled);
      logo?.classList.toggle('h-6', scrolled);

      /* Reposicionar la burbuja si est치 visible */
      if (!hoverBubble || hoverBubble.style.opacity !== '1') return;

      const activeLink = Array.from(navLinks).find(l => l.matches(':hover'));
      if (!activeLink) return;

      const rect = activeLink.getBoundingClientRect();
      const navRect = headerNav?.getBoundingClientRect(); // 游녣 CAMBIO
      if (!navRect) return;

      const scale = scrolled ? 0.9 : 1;
      hoverBubble.style.width = `${rect.width / scale}px`;
      hoverBubble.style.height = `${rect.height / scale}px`;
      hoverBubble.style.left = `${(rect.left - navRect.left) / scale}px`;
      hoverBubble.style.top = `${(rect.top - navRect.top) / scale}px`;
    });

    /* ---------- Men칰 m칩vil ---------- */
    const closeMobileMenu = () => {
      mobileMenu?.classList.add('-translate-x-full');
      mobileMenu?.classList.remove('translate-x-0');
      hamburgerIcon?.classList.remove('opacity-0', 'rotate-90');
      closeIcon?.classList.add('opacity-0', 'rotate-90');
    };

    menuToggle?.addEventListener('click', () => {
      mobileMenu?.classList.toggle('-translate-x-full');
      mobileMenu?.classList.toggle('translate-x-0');

      hamburgerIcon?.classList.toggle('opacity-0');
      hamburgerIcon?.classList.toggle('rotate-90');
      closeIcon?.classList.toggle('opacity-0');
      closeIcon?.classList.toggle('rotate-90');
    });

    mobileMenuClose?.addEventListener('click', closeMobileMenu);

    document.addEventListener('click', e => {
      if (
        mobileMenu &&
        !mobileMenu.contains(e.target as Node) &&
        !menuToggle?.contains(e.target as Node)
      ) {
        closeMobileMenu();
      }
    });
  });
</script>

<style>
  .mobile-menu-item {
    display: block;
    color: white;
  }

  html {
    scroll-behavior: smooth;
  }

  header {
    transform-origin: center top;
    will-change: transform, width;
  }
  #mobileMenu {
    will-change: transform;
  }

  .header-navigation .header-nav-item {
    position: relative;
    overflow: hidden;
  }
  .header-navigation .header-nav-item::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1) translate(-50%);
    transform-origin: 50% 50%;
  }
  .header-navigation .header-nav-item:hover::after {
    animation: header-ripple 1s ease-out;
  }
  @keyframes header-ripple {
    0% {
      transform: scale(0);
      opacity: 0.5;
    }
    100% {
      transform: scale(20);
      opacity: 0;
    }
  }
</style>
